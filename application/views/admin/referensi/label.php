<!DOCTYPE html>
<!-- 
Template Name: Metronic - Responsive Admin Dashboard Template build with Twitter Bootstrap 4
Version: 5.0.5
Author: KeenThemes
Website: http://www.keenthemes.com/
Contact: support@keenthemes.com
Follow: www.twitter.com/keenthemes
Dribbble: www.dribbble.com/keenthemes
Like: www.facebook.com/keenthemes
Purchase: http://themeforest.net/item/metronic-responsive-admin-dashboard-template/4021469?ref=keenthemes
Renew Support: http://themeforest.net/item/metronic-responsive-admin-dashboard-template/4021469?ref=keenthemes
License: You must have a valid license purchased only from themeforest(the above link) in order to legally use the theme for your project.
-->
<html lang="en" >
	<?php echo $header; ?>
				<!-- END: Left Aside -->
				
				<div class="m-grid__item m-grid__item--fluid m-wrapper">
				<div class="m-subheader ">
						<div class="d-flex align-items-center">
							<div class="mr-auto">
								<h3 class="m-subheader__title m-subheader__title--separator">
									<?php echo $title;?>
								</h3>
								<ul class="m-subheader__breadcrumbs m-nav m-nav--inline">
									<li class="m-nav__item m-nav__item--home">
										<a href="#" class="m-nav__link m-nav__link--icon">
											<i class="m-nav__link-icon la la-home"></i>
										</a>
									</li>
									<li class="m-nav__separator">
										-
									</li>
									<li class="m-nav__item">
										<a href="" class="m-nav__link">
											<span class="m-nav__link-text">
												Datatables
											</span>
										</a>
									</li>
									<li class="m-nav__separator">
										-
									</li>
									<li class="m-nav__item">
										<a href="" class="m-nav__link">
											<span class="m-nav__link-text">
												Base
											</span>
										</a>
									</li>
									<li class="m-nav__separator">
										-
									</li>
									<li class="m-nav__item">
										<a href="" class="m-nav__link">
											<span class="m-nav__link-text">
												Local Data
											</span>
										</a>
									</li>
								</ul>
							</div>
							<div>
								<div class="m-dropdown m-dropdown--inline m-dropdown--arrow m-dropdown--align-right m-dropdown--align-push" data-dropdown-toggle="hover" aria-expanded="true">
									<a href="#" class="m-portlet__nav-link btn btn-lg btn-secondary  m-btn m-btn--outline-2x m-btn--air m-btn--icon m-btn--icon-only m-btn--pill  m-dropdown__toggle">
										<i class="la la-plus m--hide"></i>
										<i class="la la-ellipsis-h"></i>
									</a>
									<div class="m-dropdown__wrapper">
										<span class="m-dropdown__arrow m-dropdown__arrow--right m-dropdown__arrow--adjust"></span>
										<div class="m-dropdown__inner">
											<div class="m-dropdown__body">
												<div class="m-dropdown__content">
													<ul class="m-nav">
														<li class="m-nav__section m-nav__section--first m--hide">
															<span class="m-nav__section-text">
																Quick Actions
															</span>
														</li>
														<li class="m-nav__item">
															<a href="" class="m-nav__link">
																<i class="m-nav__link-icon flaticon-share"></i>
																<span class="m-nav__link-text">
																	Activity
																</span>
															</a>
														</li>
														<li class="m-nav__item">
															<a href="" class="m-nav__link">
																<i class="m-nav__link-icon flaticon-chat-1"></i>
																<span class="m-nav__link-text">
																	Messages
																</span>
															</a>
														</li>
														<li class="m-nav__item">
															<a href="" class="m-nav__link">
																<i class="m-nav__link-icon flaticon-info"></i>
																<span class="m-nav__link-text">
																	FAQ
																</span>
															</a>
														</li>
														<li class="m-nav__item">
															<a href="" class="m-nav__link">
																<i class="m-nav__link-icon flaticon-lifebuoy"></i>
																<span class="m-nav__link-text">
																	Support
																</span>
															</a>
														</li>
														<li class="m-nav__separator m-nav__separator--fit"></li>
														<li class="m-nav__item">
															<a href="#" class="btn btn-outline-danger m-btn m-btn--pill m-btn--wide btn-sm">
																Submit
															</a>
														</li>
													</ul>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				<div class="m-content">
						<div class="m-alert m-alert--icon m-alert--air m-alert--square alert alert-dismissible m--margin-bottom-30" role="alert">
							<div class="m-alert__icon">
								<i class="flaticon-exclamation m--font-primary"></i>
							</div>
							<div class="m-alert__text">
								Fungsi GMD: Memberitahu pemustaka sedini mungkin tentang format/bentuk fisik dokumen Mengisyaratkan pada pemustaka bahwa diperlukan alat khusus Menjadi sarana untuk membedakan dokumen dengan judul sama tapi bentuk berbeda Meskipun telah diganti dengan aturan Resource Description and Access (RDA), masih banyak institusi yang menggunakan AACR2 Dalam AACR2 terdapat 2 daftar GMD, daftar pertama digunakan di Inggris, yang kedua digunakan di Amerika Serikat. Indonesia menggunakan daftar kedua.
							</div>
						</div>
						<div class="m-portlet m-portlet--mobile">
							<div class="m-portlet__head">
								<div class="m-portlet__head-caption">
									<div class="m-portlet__head-title">
										<h3 class="m-portlet__head-text">
											<?php echo $title; ?>
											<small>
												Resource Description and Access
											</small>
										</h3>
									</div>
								</div>
								<div class="m-portlet__head-tools">
									<ul class="m-portlet__nav">
										<li class="m-portlet__nav-item">
											<div class="m-dropdown m-dropdown--inline m-dropdown--arrow m-dropdown--align-right m-dropdown--align-push" data-dropdown-toggle="hover" aria-expanded="true">
												<a href="#" class="m-portlet__nav-link btn btn-lg btn-secondary  m-btn m-btn--icon m-btn--icon-only m-btn--pill  m-dropdown__toggle">
													<i class="la la-ellipsis-h m--font-brand"></i>
												</a>
												<div class="m-dropdown__wrapper">
													<span class="m-dropdown__arrow m-dropdown__arrow--right m-dropdown__arrow--adjust"></span>
													<div class="m-dropdown__inner">
														<div class="m-dropdown__body">
															<div class="m-dropdown__content">
																<ul class="m-nav">
																	<li class="m-nav__section m-nav__section--first">
																		<span class="m-nav__section-text">
																			Quick Actions
																		</span>
																	</li>
																	<li class="m-nav__item">
																		<a href="" class="m-nav__link">
																			<i class="m-nav__link-icon flaticon-share"></i>
																			<span class="m-nav__link-text">
																				Create Post
																			</span>
																		</a>
																	</li>
																	<li class="m-nav__item">
																		<a href="" class="m-nav__link">
																			<i class="m-nav__link-icon flaticon-chat-1"></i>
																			<span class="m-nav__link-text">
																				Send Messages
																			</span>
																		</a>
																	</li>
																	<li class="m-nav__item">
																		<a href="" class="m-nav__link">
																			<i class="m-nav__link-icon flaticon-multimedia-2"></i>
																			<span class="m-nav__link-text">
																				Upload File
																			</span>
																		</a>
																	</li>
																	<li class="m-nav__section">
																		<span class="m-nav__section-text">
																			Useful Links
																		</span>
																	</li>
																	<li class="m-nav__item">
																		<a href="" class="m-nav__link">
																			<i class="m-nav__link-icon flaticon-info"></i>
																			<span class="m-nav__link-text">
																				FAQ
																			</span>
																		</a>
																	</li>
																	<li class="m-nav__item">
																		<a href="" class="m-nav__link">
																			<i class="m-nav__link-icon flaticon-lifebuoy"></i>
																			<span class="m-nav__link-text">
																				Support
																			</span>
																		</a>
																	</li>
																	<li class="m-nav__separator m-nav__separator--fit m--hide"></li>
																	<li class="m-nav__item m--hide">
																		<a href="#" class="btn btn-outline-danger m-btn m-btn--pill m-btn--wide btn-sm">
																			Submit
																		</a>
																	</li>
																</ul>
															</div>
														</div>
													</div>
												</div>
											</div>
										</li>
									</ul>
								</div>
							</div>
							<div class="m-portlet__body">
								<!--begin: Search Form -->
								<div class="m-form m-form--label-align-right m--margin-top-20 m--margin-bottom-30">
									<div class="row align-items-center">
										<div class="col-xl-8 order-2 order-xl-1">
											<div class="form-group m-form__group row align-items-center">
												
												<div class="col-md-6">
													<div class="m-input-icon m-input-icon--left">
														<input type="text" class="form-control m-input" placeholder="Search..." id="generalSearch">
														<span class="m-input-icon__icon m-input-icon__icon--left">
															<span>
																<i class="la la-search"></i>
															</span>
														</span>
													</div>
												</div>
											</div>
										</div>
										<div class="col-xl-4 order-1 order-xl-2 m--align-right">
											<a href="#" class="btn btn-primary m-btn m-btn--custom m-btn--icon m-btn--air m-btn--pill" data-toggle="modal" data-target="#addModal">
												<span>
													<i class="la la-plus-circle"></i>
													<span>
														Tambah data
													</span>
												</span>
											</a>
											<div class="m-separator m-separator--dashed d-xl-none"></div>
										</div>
									</div>
								</div>
								<!--end: Search Form -->
		<!--begin: Datatable -->
								<table class="m-datatable" id="html_table" width="100%">
    								<thead>
										<tr>
											<th title="Field #1">
												No. urut
											</th>
											<th title="Field #2">
												Nama Label
											</th>
											<th title="Field #3">
												Deskripsi Label
											</th>
											<th title="Field #4">
												Gambar
											</th>
											<th title="Field #5">
												Perubahan Terakhir
											</th>
											<th title="Field #6">
												Aksi
											</th>
										</tr>
    								</thead>
    								<tbody>
									<?php $count = 1; ?>
            						<?php foreach ($label as $t): ?>
                						<tr>
                    						<td><?php echo $count; ?></td>
                    						<td><?php echo $t->nama_label; ?></td>
											<td><?php echo $t->deskripsi_label; ?></td>
											<td><img src="<?php echo base_url('images/labels/' . $t->gambar); ?>" alt="Label Image" width="50"></td>
                    						<td><?php if($t->last_update !== null){
														echo $t->last_update;
													} else {
													echo $t->input_date;
													}
												?></td>
                    						<td>
                       						 <!-- Tambahkan ikon hapus -->
												<a class="m-portlet__nav-link btn m-btn m-btn--hover-accent m-btn--icon m-btn--icon-only m-btn--pill btnEditTipe" title="Edit" data-id="<?php echo $t->id; ?>">
    											<i class="la la-edit"></i></a>
												<a class="m-portlet__nav-link btn m-btn m-btn--hover-accent m-btn--icon m-btn--icon-only m-btn--pill btnDeleteGmd" title="Delete" data-id="<?php echo $t->id; ?>"  data-nama_label="<?php echo $t->nama_label; ?>">
    											<i class="la la-trash"></i>
												</a>
                    						</td>
                						</tr>
                					<?php $count++; ?>
            						<?php endforeach; ?>
    								</tbody>
								</table>

								<!--end: Datatable -->
							</div>
						</div>
					</div>
				</div>
			
		<!-- application/views/gmd_view.php -->
<!-- ... -->
<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Edit data Label</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="editTipeForm" action="<?php echo base_url('admin/referensi/Label/updateLabel'); ?>" method="post">
                    <div class="form-group">
                        <label class="form-control-label">Nama Label</label>
                        <input type="text" class="form-control" id="nama_label" name="nama_label">
                    </div>
                    <div class="form-group">
                        <label class="form-control-label">Deskripsi Label</label>
                        <input type="text" class="form-control" id="deskripsi_label" name="deskripsi_label">
                    </div>
                    <div class="form-group">
                        <label class="form-control-label">Preview Gambar</label>
                        <!-- Image preview -->
                        <img id="gambar-preview" src="" alt="Label Image" style="max-width: 150px;">
                        <input type="file" id="gambar" name="gambar" class="form-control">
                        <span class="m-form__help">Maximum 500 KB.</span>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary" id="btnUpdateTipe">Update data</button>
                <input type="hidden" id="labelId" name="labelId">
            </div>
        </div>
    </div>
</div>


<!-- Add Modal -->
<div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Tambah Data Label</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
				<div class="form-group">
                    <label class="form-control-label">Nama Label</label>
                    <input type="text" class="form-control" id="label" name="nama_label">
                </div>
				<div class="form-group">
                    <label class="form-control-label">Deskripsi Label</label>
                    <input type="text" class="form-control" id="deskripsi" name="deskripsi_label">
                </div>
				<div class="form-group">
					<label class="form-control-label">Gambar</label>					
					<input type="file" id="gmbr" name="gambar" class="form-control" >
					<span class="m-form__help">Maximum 500 KB.</span>
				</div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="btnAddTipe">Tambah data</button>
            </div>
        </div>
    </div>
</div>



</div>
    </div>
</div>
<!-- ... -->

			<!-- end:: Body -->
<!-- begin::Footer -->
	<?php echo $footer; ?>
	</body>
	<!-- end::Body -->
</html>
<script>
        var baseUrl = '<?php echo base_url(); ?>';
</script>
<script>
//== Class definition
var DatatableHtmlTableDemo = function() {
  //== Private functions

  // demo initializer
  var demo = function() {

    var datatable = $('.m-datatable').mDatatable({
      data: {
        saveState: {cookie: false},
      },
      search: {
        input: $('#generalSearch'),
      },
      columns: [
        {
          field: 'Nama GMD',
          textAlign: 'center'
        },
        {
          field: 'last_update',
          type: 'date',
          format: 'DD-MM-YYYY',
        },
      ],
    });
  };

  return {
    //== Public functions
    init: function() {
      // init dmeo
      demo();
    },
  };
}();
jQuery(document).ready(function() {
  DatatableHtmlTableDemo.init();
});
</script>


<script>
    $(document).ready(function () {
        function handleDelete(labelId, nama_label) {
            if (confirm("Apakah Anda yakin ingin menghapus data Tempat[" + labelId + "] [" + nama_label + "] ini?")) {
                $.post("<?php echo base_url('admin/referensi/Label/deleteLabel/'); ?>" + labelId, function (response) {
                    if (response.status === "success") {
                        alert(response.message);
                        location.reload();
                    }
                }, 'json');
            }
        }

		$("#btnAddTipe").click(function (event) {
			event.preventDefault(); // Prevent the default form submission

			var formData = new FormData(); // Buat objek FormData untuk mengirim file

			formData.append('nama_label', $("#label").val());
			formData.append('deskripsi_label', $("#deskripsi").val());
			formData.append('gambar', $("#gmbr")[0].files[0]);

			$.ajax({
				url: "<?php echo base_url('admin/referensi/Label/addLabel'); ?>",
				type: "POST",
				data: formData,
				dataType: "json",
				processData: false, // Jangan memproses data
				contentType: false, // Tidak ada tipe konten

				success: function (response) {
					if (response.status === 'success') {
						// Clear form fields
						$("#label").val("");
						$("#deskripsi").val("");
						$("#gmbr").val("");
						// Close the modal
						$("#addModal").modal('hide');
						// Display success message (you can customize this)
						alert(response.message);
						location.reload();
					} else {
						// Display error message (you can customize this)
						alert(response.message);
					}
				},
				error: function (xhr, status, error) {
					alert("Terjadi kesalahan saat menghubungi server.");
				}
			});
		});

        // Add event listener to the "Hapus" buttons
        $(document).on('click', '.btnDeleteGmd', function () {
            var labelId = $(this).data("id");
			var nama_label = $(this).data("nama_label");
            handleDelete(labelId, nama_label);
        });

        // Additional event listener for the "Edit" buttons
		$(document).on('click', '.btnEditTipe', function () {
			var labelId = $(this).data('id');

			// AJAX request to fetch label data
			$.ajax({
				url: 'Label/editLabel/' + labelId,
				type: 'GET',
				dataType: 'json',
				success: function (data) {
					$('#labelId').val(data.id);
					$('#nama_label').val(data.nama_label);
					$('#deskripsi_label').val(data.deskripsi_label);
					
					// Show the image using an <img> element
					if (data.gambar) {
						$('#gambar-preview').attr('src', '<?php echo base_url('images/labels/'); ?>' + data.gambar);
					} else {
						// Hide the image if no image is available
						$('#gambar-preview').attr('src', '').hide();
					}
					

					$('#editModal').modal('show');
				},
				error: function (xhr, status, error) {
					console.log(error);
				}
			});
		});
		
		function showUpdateSuccessAlert(message) {
            $("#updateSuccessAlert strong").text(message);
            $("#updateSuccessAlert").show();
        }

        function hideUpdateSuccessAlert() {
            $("#updateSuccessAlert").hide();
        }


		function handleUpdate() {
			var labelId = $("#labelId").val();
			var nama_label = $("#nama_label").val();
			var deskripsi_label = $("#deskripsi_label").val();

			// Buat objek FormData untuk mengirim file gambar
			var formData = new FormData();
			formData.append('id', labelId);
			formData.append('nama_label', nama_label);
			formData.append('deskripsi_label', deskripsi_label);

			// Periksa apakah ada file gambar yang diunggah
			if ($('#gambar')[0].files.length > 0) {
				formData.append('gambar', $('#gambar')[0].files[0]);
			}

			$.ajax({
				url: '<?php echo base_url('admin/referensi/Label/updateLabel'); ?>',
				type: "post",
				data: formData,
				dataType: "json",
				contentType: false,
				processData: false,
				success: function (response) {
					if (response.status === "success") {
						showUpdateSuccessAlert(response.message);
						$("#editTipeForm")[0].reset();
						alert(response.message);
						location.reload();
					} else if (response.status === "error") {
						alert(response.message); // Tampilkan pesan error jika diperlukan
					}
				},
				error: function (xhr, status, error) {
					alert("Terjadi kesalahan saat menghubungi server: " + error);
				}
			});
		}

		// Event click pada button "Update data"
		$("#btnUpdateTipe").click(function (e) {
			e.preventDefault(); // Hindari pengiriman form biasa, karena Anda mengirimnya melalui AJAX
			handleUpdate();
		});



    });
</script>
